---
{
   "apiVersion": "v1",
   "data": {
      "config-init.hcl": "exit_after_auth = true\n\npid_file = \"/home/vault/pidfile\"\n\nauto_auth {\n  method \"kubernetes\" {\n    mount_path = \"auth/kubernetes\"\n    config = {\n      role = \"autounseal\"\n    }\n  }\n}\n\ntemplate {\n  destination = \"/vault/secrets/server-config\"\n  contents = <<-EOT\n    disable_mlock = true\n    // log_level = \"debug\"\n    ui = true\n    // For peers in the raft to talk to each other\n    listener \"tcp\" {\n      tls_disable = 0\n      tls_cert_file = \"/vault-tls-internal/tls.crt\"\n      tls_key_file = \"/vault-tls-internal/tls.key\"\n      address = \"[::]:8200\"\n      cluster_address = \"[::]:8201\"\n    }\n    // For clients to talk to the cluster\n    listener \"tcp\" {\n      tls_disable = 0\n      tls_cert_file = \"/vault-tls-web/tls.crt\"\n      tls_key_file = \"/vault-tls-web/tls.key\"\n      address = \"[::]:8300\"\n      cluster_address = \"[::]:8301\"\n    }\n    seal \"transit\" {\n      address = \"https://vault-unsealer.test.wirywolf.com\"\n      disable_renewal = \"false\"\n      key_name = \"autounseal\"\n      mount_path = \"transit/\"\n      tls_skip_verify = \"true\"\n      {{ with secret \"auth/token/lookup-self\" -}}\n      token = \"{{ .Data.id }}\"\n      {{ end }}\n    }\n    storage \"raft\" {\n      path = \"/vault/data\"\n      retry_join {\n        leader_api_addr = \"https://vault-0.vault-internal:8200\"\n        leader_ca_cert_file = \"/vault-tls-internal/tls.crt\"\n      }\n      retry_join {\n        leader_api_addr = \"https://vault-1.vault-internal:8200\"\n        leader_ca_cert_file = \"/vault-tls-internal/tls.crt\"\n      }\n      retry_join {\n        leader_api_addr = \"https://vault-2.vault-internal:8200\"\n        leader_ca_cert_file = \"/vault-tls-internal/tls.crt\"\n      }\n    }\n    service_registration \"kubernetes\" {}\n    EOT\n}\n"
   },
   "kind": "ConfigMap",
   "metadata": {
      "name": "vault-agent-autounseal",
      "namespace": "vault"
   }
}
...
